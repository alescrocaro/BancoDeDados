DROP TABLE IF EXISTS MAO_DE_OBRA;
DROP TABLE IF EXISTS FUNCIONARIO;
DROP TABLE IF EXISTS CATEGORIA;
DROP TABLE IF EXISTS REPARO_PECA;
DROP TABLE IF EXISTS PECA;
DROP TABLE IF EXISTS REPARO;
DROP TABLE IF EXISTS CLIENTE_TEM_VEICULO;
DROP TABLE IF EXISTS VEICULO;
DROP TABLE IF EXISTS CLIENTE;

CREATE TABLE CLIENTE(
  id INTEGER PRIMARY KEY,
  nome VARCHAR(255),
  endereco VARCHAR(255),
  telefone CHAR(9)
);

CREATE TABLE VEICULO(
  placa CHAR (7) PRIMARY KEY
);

CREATE TABLE CLIENTE_TEM_VEICULO(
  id_cliente INTEGER,
  placa CHAR(7),
  PRIMARY KEY(id_cliente, placa),
  FOREIGN KEY(id_cliente) REFERENCES CLIENTE(id),
  FOREIGN KEY(placa) REFERENCES VEICULO(placa)
);

CREATE TABLE REPARO(
  id INTEGER PRIMARY KEY,
  custo DECIMAL(10,2),
  data_reparo DATE,
  id_cliente INTEGER ,
  placa CHAR(7),
  FOREIGN KEY(id_cliente, placa) REFERENCES CLIENTE_TEM_VEICULO(id_cliente, placa)
);

CREATE TABLE PECA(
  codigo INTEGER PRIMARY KEY,
  designacao VARCHAR(255),
  custo DECIMAL(10,2),
  qtde INTEGER
);

CREATE TABLE REPARO_PECA(
  id_reparo INTEGER,
  cod_peca INTEGER,
  custo DECIMAL(10, 2),
  PRIMARY KEY(id_reparo, cod_peca),
  FOREIGN KEY(id_reparo) REFERENCES REPARO(id),
  FOREIGN KEY(cod_peca) REFERENCES PECA(codigo)
);

CREATE TABLE CATEGORIA(
  nome VARCHAR(100) PRIMARY KEY,
  custo DECIMAL(10,2)
);

CREATE TABLE FUNCIONARIO(
  id INTEGER PRIMARY KEY,
  nome VARCHAR(255),
  endereco VARCHAR(255),
  telefone CHAR(9),
  nome_categoria VARCHAR(100),
  FOREIGN KEY(nome_categoria) REFERENCES CATEGORIA(nome)
);

CREATE TABLE MAO_DE_OBRA(
  id_funcionario INTEGER,
  id_reparo INTEGER,
  tempo TIME,
  custo_mao_obra DECIMAL(10, 2),
  PRIMARY KEY(id_funcionario, id_reparo),
  FOREIGN KEY(id_funcionario) REFERENCES FUNCIONARIO(id),
  FOREIGN KEY(id_reparo) REFERENCES REPARO(id)
);